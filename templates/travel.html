{% extends "base.html" %}

{% block title %}HERA - Travel Arrangements{% endblock %}

{% block page_title %}Travel Arrangements{% endblock %}

{% block styles %}
<link href="{{ url_for('static', filename='css/travel.css') }}" rel="stylesheet">
<!-- Leaflet CSS for flight map -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" />
{% endblock %}

{% block content %}

<!-- Flight Path Map Module -->
<div class="flight-map-section">
    <div class="widget">
        <div class="widget-header">
            <div class="map-title-group">
                <h3 class="widget-title">
                    <svg class="flight-icon" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M21 16v-2l-8-5V3.5c0-.83-.67-1.5-1.5-1.5S10 2.67 10 3.5V9l-8 5v2l8-2.5V19l-2 1.5V22l3.5-1 3.5 1v-1.5L13 19v-5.5l8 2.5z"/>
                    </svg>
                    Flight Route Visualization
                </h3>
                <p class="widget-subtitle">Washington → Denver → Calgary → Toronto → Washington</p>
            </div>
            <div class="map-controls">
                <button class="map-toggle active" data-layer="route" title="Show Flight Path">
                    <i class="fas fa-route"></i> Route
                </button>
                <button class="map-toggle" data-layer="airports" title="Show Airports">
                    <i class="fas fa-map-marker-alt"></i> Airports
                </button>
                <button class="map-toggle" data-layer="weather" title="Show Weather">
                    <i class="fas fa-cloud"></i> Weather
                </button>
                <button class="map-toggle" data-layer="elevation" title="Show Elevation">
                    <i class="fas fa-mountain"></i> Terrain
                </button>
            </div>
        </div>

        <!-- Interactive Flight Map -->
        <div id="flight-map" class="flight-map loading">
            <div class="map-loading">
                <div class="loading-spinner"></div>
                <p>Loading flight path...</p>
            </div>
        </div>

        <!-- Flight Statistics -->
        <div class="flight-summary">
            <div class="flight-stat">
                <span class="stat-number">4</span>
                <span class="stat-label">Total Flights</span>
            </div>
            <div class="flight-stat">
                <span class="stat-number">~13h 28m</span>
                <span class="stat-label">Flight Time</span>
            </div>
            <div class="flight-stat">
                <span class="stat-number">3,847</span>
                <span class="stat-label">Total Miles</span>
            </div>
            <div class="flight-stat">
                <span class="stat-number">3</span>
                <span class="stat-label">Connections</span>
            </div>
            <div class="flight-stat">
                <span class="stat-number">$11.20</span>
                <span class="stat-label">Total Cost</span>
            </div>
        </div>

        <!-- Live Flight Status -->
        <div class="flight-status-bar">
            <div class="status-item">
                <div class="status-indicator on-time"></div>
                <span>All flights confirmed & on schedule</span>
            </div>
            <div class="status-item">
                <div class="status-indicator"></div>
                <span>Weather: Clear conditions expected</span>
            </div>
            <div class="status-item">
                <div class="status-indicator"></div>
                <span>Last updated: <span id="last-updated">Just now</span></span>
            </div>
        </div>
    </div>
</div>

<!-- Travel Sections -->
<div class="travel-sections">
    <!-- Outbound Flights -->
    <div class="widget">
        <div class="widget-header">
            <div>
                <h3 class="widget-title">
                    <i class="fas fa-plane-departure"></i>
                    Outbound Flights
                </h3>
                <p class="widget-subtitle">September 24, 2025 - Washington to Calgary</p>
            </div>
            <button class="action-btn add-btn" onclick="openAddFlightModal('outbound')" data-tooltip="Add Flight">
                <i class="fas fa-plus"></i>
            </button>
        </div>

        <div class="travel-cards">
            {% for travel in outbound_flights %}
            <div class="travel-card flight-card" data-travel-id="{{ travel.id }}">
                <div class="travel-header">
                    <div class="flight-route">
                        <span class="airport-code">{{ travel.segment.split(' - ')[0] }}</span>
                        <i class="fas fa-arrow-right"></i>
                        <span class="airport-code">{{ travel.segment.split(' - ')[1] }}</span>
                    </div>
                    <div class="flight-number">{{ travel.flightNumber }}</div>
                </div>

                <div class="travel-details">
                    <div class="travel-detail">
                        <div class="detail-label">Departure</div>
                        <div class="detail-value">{{ travel.departureTime if travel.departureTime else 'TBD' }}</div>
                    </div>
                    <div class="travel-detail">
                        <div class="detail-label">Arrival</div>
                        <div class="detail-value">{{ travel.arrivalTime if travel.arrivalTime else 'TBD' }}</div>
                    </div>
                    <div class="travel-detail">
                        <div class="detail-label">Duration</div>
                        <div class="detail-value">{{ travel.duration or 'N/A' }}</div>
                    </div>
                    <div class="travel-detail">
                        <div class="detail-label">Seats</div>
                        <div class="detail-value">{{ travel.seat or 'TBD' }}</div>
                    </div>
                    <div class="travel-detail">
                        <div class="detail-label">Confirmation</div>
                        <div class="detail-value editable" data-field="confirmation" data-id="{{ travel.id }}">
                            {{ travel.confirmationNumber or 'Pending' }}
                        </div>
                    </div>
                </div>

                <div class="travel-actions">
                    <button class="action-btn edit-btn" onclick="editTravel({{ travel.id }})" data-tooltip="Edit Flight">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="action-btn status-btn" onclick="toggleFlightStatus({{ travel.id }})" data-tooltip="Update Status">
                        <i class="fas fa-plane"></i>
                    </button>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Return Flights -->
    <div class="widget">
        <div class="widget-header">
            <div>
                <h3 class="widget-title">
                    <i class="fas fa-plane-arrival"></i>
                    Return Flights
                </h3>
                <p class="widget-subtitle">September 29, 2025 - Calgary to Washington</p>
            </div>
            <button class="action-btn add-btn" onclick="openAddFlightModal('return')" data-tooltip="Add Flight">
                <i class="fas fa-plus"></i>
            </button>
        </div>

        <div class="travel-cards">
            {% for travel in return_flights %}
            <div class="travel-card flight-card" data-travel-id="{{ travel.id }}">
                <div class="travel-header">
                    <div class="flight-route">
                        <span class="airport-code">{{ travel.segment.split(' - ')[0] }}</span>
                        <i class="fas fa-arrow-right"></i>
                        <span class="airport-code">{{ travel.segment.split(' - ')[1] }}</span>
                    </div>
                    <div class="flight-number">{{ travel.flightNumber }}</div>
                </div>

                <div class="travel-details">
                    <div class="travel-detail">
                        <div class="detail-label">Departure</div>
                        <div class="detail-value">{{ travel.departureTime if travel.departureTime else 'TBD' }}</div>
                    </div>
                    <div class="travel-detail">
                        <div class="detail-label">Arrival</div>
                        <div class="detail-value">{{ travel.arrivalTime if travel.arrivalTime else 'TBD' }}</div>
                    </div>
                    <div class="travel-detail">
                        <div class="detail-label">Duration</div>
                        <div class="detail-value">{{ travel.duration or 'N/A' }}</div>
                    </div>
                    <div class="travel-detail">
                        <div class="detail-label">Seats</div>
                        <div class="detail-value">{{ travel.seat or 'TBD' }}</div>
                    </div>
                    <div class="travel-detail">
                        <div class="detail-label">Confirmation</div>
                        <div class="detail-value editable" data-field="confirmation" data-id="{{ travel.id }}">
                            {{ travel.confirmationNumber or 'Pending' }}
                        </div>
                    </div>
                </div>

                <div class="travel-actions">
                    <button class="action-btn edit-btn" onclick="editTravel({{ travel.id }})" data-tooltip="Edit Flight">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="action-btn status-btn" onclick="toggleFlightStatus({{ travel.id }})" data-tooltip="Update Status">
                        <i class="fas fa-plane"></i>
                    </button>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Hotels Section -->
    <div class="widget">
        <div class="widget-header">
            <div>
                <h3 class="widget-title">
                    <i class="fas fa-hotel"></i>
                    Hotel Accommodations
                </h3>
                <p class="widget-subtitle">September 24-29, 2025 - Banff, AB</p>
            </div>
            <button class="action-btn add-btn" onclick="openAddHotelModal()" data-tooltip="Add Hotel">
                <i class="fas fa-plus"></i>
            </button>
        </div>

        <div class="travel-cards">
            {% for hotel in hotels %}
            <div class="travel-card hotel-card" data-travel-id="{{ hotel.id }}">
                <div class="travel-header">
                    <div class="hotel-info">
                        <div class="hotel-name">{{ hotel.name }}</div>
                        <div class="hotel-address">{{ hotel.address }}</div>
                    </div>
                    <div class="hotel-rating">
                        <div class="stars">
                            {% for i in range(5) %}
                            <i class="fas fa-star"></i>
                            {% endfor %}
                        </div>
                    </div>
                </div>

                <div class="travel-details">
                    <div class="travel-detail">
                        <div class="detail-label">Check-in</div>
                        <div class="detail-value">{{ hotel.checkInDate if hotel.checkInDate else 'TBD' }}</div>
                    </div>
                    <div class="travel-detail">
                        <div class="detail-label">Check-out</div>
                        <div class="detail-value">{{ hotel.checkOutDate if hotel.checkOutDate else 'TBD' }}</div>
                    </div>
                    <div class="travel-detail">
                        <div class="detail-label">Nights</div>
                        <div class="detail-value">5</div>
                    </div>
                    <div class="travel-detail">
                        <div class="detail-label">Room Type</div>
                        <div class="detail-value">{{ hotel.notes or 'Standard' }}</div>
                    </div>
                    <div class="travel-detail">
                        <div class="detail-label">Confirmation</div>
                        <div class="detail-value editable" data-field="confirmation" data-id="{{ hotel.id }}">
                            {{ hotel.confirmationNumber or 'Pending' }}
                        </div>
                    </div>
                </div>

                <div class="travel-actions">
                    <button class="action-btn edit-btn" onclick="editTravel({{ hotel.id }})" data-tooltip="Edit Hotel">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="action-btn phone-btn" onclick="callHotel('{{ hotel.phoneNumber }}')" data-tooltip="Call Hotel">
                        <i class="fas fa-phone"></i>
                    </button>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Ground Transportation -->
    <div class="widget">
        <div class="widget-header">
            <div>
                <h3 class="widget-title">
                    <i class="fas fa-car"></i>
                    Ground Transportation
                </h3>
                <p class="widget-subtitle">Rental Car & Local Transport</p>
            </div>
            <button class="action-btn add-btn" onclick="openAddTransportModal()" data-tooltip="Add Transport">
                <i class="fas fa-plus"></i>
            </button>
        </div>

        <div class="travel-cards">
            {% for transport in ground_transport %}
            <div class="travel-card transport-card" data-travel-id="{{ transport.id }}">
                <div class="travel-header">
                    <div class="transport-info">
                        <div class="transport-provider">{{ transport.company }}</div>
                        <div class="transport-location">{{ transport.location }}</div>
                    </div>
                    <div class="transport-type">
                        <i class="fas fa-car"></i>
                        {{ transport.carType or 'Vehicle' }}
                    </div>
                </div>

                <div class="travel-details">
                    <div class="travel-detail">
                        <div class="detail-label">Pick-up</div>
                        <div class="detail-value">{{ transport.pickupDate if transport.pickupDate else 'TBD' }}</div>
                    </div>
                    <div class="travel-detail">
                        <div class="detail-label">Drop-off</div>
                        <div class="detail-value">{{ transport.dropoffDate if transport.dropoffDate else 'TBD' }}</div>
                    </div>
                    <div class="travel-detail">
                        <div class="detail-label">Duration</div>
                        <div class="detail-value">5 days</div>
                    </div>
                    <div class="travel-detail">
                        <div class="detail-label">Confirmation</div>
                        <div class="detail-value editable" data-field="confirmation" data-id="{{ transport.id }}">
                            {{ transport.confirmationNumber or 'Pending' }}
                        </div>
                    </div>
                </div>

                <div class="travel-actions">
                    <button class="action-btn edit-btn" onclick="editTravel({{ transport.id }})" data-tooltip="Edit Rental">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="action-btn location-btn" onclick="showLocation('{{ transport.location }}')" data-tooltip="Show Location">
                        <i class="fas fa-map-marker-alt"></i>
                    </button>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<!-- Leaflet JavaScript -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js"></script>
<script src="{{ url_for('static', filename='js/travel.js') }}"></script>
{% endblock %}