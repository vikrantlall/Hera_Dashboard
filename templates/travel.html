{% extends "base.html" %}

{% block title %}HERA - Travel Arrangements{% endblock %}

{% block page_title %}Travel Arrangements{% endblock %}

{% block styles %}
<link href="{{ url_for('static', filename='css/travel.css') }}" rel="stylesheet">
<!-- Leaflet CSS for flight map -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" />
{% endblock %}

{% block content %}

<!-- Enhanced Flight Path Map Module (ONLY THIS SECTION CHANGED) -->
<div class="flight-map-section">
    <div class="widget">
        <div class="widget-header">
            <div class="map-title-group">
                <h3 class="widget-title">
                    <svg class="flight-icon" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M21 16v-2l-8-5V3.5c0-.83-.67-1.5-1.5-1.5S10 2.67 10 3.5V9l-8 5v2l8-2.5V19l-2 1.5V22l3.5-1 3.5 1v-1.5L13 19v-5.5l8 2.5z"/>
                    </svg>
                    Live Flight Tracker
                </h3>
                <p class="widget-subtitle">Washington → Denver → Calgary → Toronto → Washington</p>
            </div>
            <!--div class="map-controls">
                <button class="map-toggle active" data-layer="route" title="Show Flight Path">
                    <i class="fas fa-route"></i> Route
                </button>
                <button class="map-toggle" data-layer="airports" title="Show Airports">
                    <i class="fas fa-map-marker-alt"></i> Airports
                </button>
                <button class="map-toggle" data-layer="weather" title="Show Weather">
                    <i class="fas fa-cloud"></i> Weather
                </button>
                <button class="map-toggle" data-layer="elevation" title="Show Elevation">
                    <i class="fas fa-mountain"></i> Terrain
                </button>
            </div> -->
        </div>

        <!-- Enhanced Interactive Flight Map with Animation -->
        <div class="flight-tracker">
            <div class="map-container">
                <div id="map"></div>
                <button class="play-button" id="playButton">
                    <span id="playText">▶ Start Journey</span>
                </button>
            </div>
        </div>

        <!-- Flight Statistics (keeping your original) -->
        <div class="flight-summary">
            <div class="flight-stat">
                <span class="stat-number">4</span>
                <span class="stat-label">Total Flights</span>
            </div>
            <div class="flight-stat">
                <span class="stat-number">2,847</span>
                <span class="stat-label">Total Miles</span>
            </div>
            <div class="flight-stat">
                <span class="stat-number">8h 15m</span>
                <span class="stat-label">Flight Time</span>
            </div>
            <div class="flight-stat">
                <span class="stat-number">$1,247</span>
                <span class="stat-label">Total Cost</span>
            </div>
        </div>

        <!-- Flight Status Bar (keeping your original) -->
        <div class="flight-status-bar">
            <div class="status-item">
                <span class="status-indicator on-time"></span>
                <span>On Time</span>
            </div>
            <div class="status-item">
                <span class="status-indicator delayed"></span>
                <span>Delayed</span>
            </div>
            <div class="status-item">
                <span class="status-indicator cancelled"></span>
                <span>Cancelled</span>
            </div>
            <div class="status-item">
                <span>Last Updated: <span id="last-updated">--:--</span></span>
            </div>
        </div>
    </div>
</div>

<!-- Travel Content Sections (EVERYTHING BELOW STAYS EXACTLY THE SAME) -->
<div class="travel-sections">
    <!-- Outbound Flights Section -->
    <div class="widget">
        <div class="widget-header">
            <div>
                <h3 class="widget-title">
                    <i class="fas fa-plane-departure"></i>
                    Outbound Flights
                </h3>
                <p class="widget-subtitle">September 24, 2025 - Washington to Calgary</p>
            </div>
            <button class="action-btn add-btn" onclick="openAddFlightModal('outbound')" data-tooltip="Add Flight">
                <i class="fas fa-plus"></i>
            </button>
        </div>

        <div class="travel-cards">
            {% for flight in outbound_flights %}
            <div class="travel-card flight-card" data-travel-id="{{ flight.id }}">
                <div class="travel-header">
                    <div class="flight-route">
                        <span class="airport-code">{{ flight.segment.split(' - ')[0] }}</span>
                        <i class="fas fa-long-arrow-alt-right"></i>
                        <span class="airport-code">{{ flight.segment.split(' - ')[1] }}</span>
                    </div>
                    <div class="flight-number">{{ flight.flightNumber or 'TBD' }}</div>
                </div>

                <div class="travel-details">
                    <div class="travel-detail">
                        <div class="detail-label">Departure</div>
                        <div class="detail-value">{{ flight.departureTime or 'TBD' }}</div>
                    </div>
                    <div class="travel-detail">
                        <div class="detail-label">Arrival</div>
                        <div class="detail-value">{{ flight.arrivalTime or 'TBD' }}</div>
                    </div>
                    <div class="travel-detail">
                        <div class="detail-label">Duration</div>
                        <div class="detail-value">{{ flight.duration or 'TBD' }}</div>
                    </div>
                    <div class="travel-detail">
                        <div class="detail-label">Status</div>
                        <div class="detail-value {{ 'success' if flight.status == 'Confirmed' else 'pending' }}">
                            {{ flight.status or 'Pending' }}
                        </div>
                    </div>
                </div>

                <div class="travel-actions">
                    <button class="action-btn edit-btn" onclick="editTravel({{ flight.id }})" data-tooltip="Edit Flight">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="action-btn status-btn" onclick="toggleFlightStatus({{ flight.id }})" data-tooltip="Update Status">
                        <i class="fas fa-plane"></i>
                    </button>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Return Flights Section -->
    <div class="widget">
        <div class="widget-header">
            <div>
                <h3 class="widget-title">
                    <i class="fas fa-plane-arrival"></i>
                    Return Flights
                </h3>
                <p class="widget-subtitle">September 29, 2025 - Calgary to Washington</p>
            </div>
            <button class="action-btn add-btn" onclick="openAddFlightModal('return')" data-tooltip="Add Flight">
                <i class="fas fa-plus"></i>
            </button>
        </div>

        <div class="travel-cards">
            {% for flight in return_flights %}
            <div class="travel-card flight-card" data-travel-id="{{ flight.id }}">
                <div class="travel-header">
                    <div class="flight-route">
                        <span class="airport-code">{{ flight.segment.split(' - ')[0] }}</span>
                        <i class="fas fa-long-arrow-alt-right"></i>
                        <span class="airport-code">{{ flight.segment.split(' - ')[1] }}</span>
                    </div>
                    <div class="flight-number">{{ flight.flightNumber or 'TBD' }}</div>
                </div>

                <div class="travel-details">
                    <div class="travel-detail">
                        <div class="detail-label">Departure</div>
                        <div class="detail-value">{{ flight.departureTime or 'TBD' }}</div>
                    </div>
                    <div class="travel-detail">
                        <div class="detail-label">Arrival</div>
                        <div class="detail-value">{{ flight.arrivalTime or 'TBD' }}</div>
                    </div>
                    <div class="travel-detail">
                        <div class="detail-label">Duration</div>
                        <div class="detail-value">{{ flight.duration or 'TBD' }}</div>
                    </div>
                    <div class="travel-detail">
                        <div class="detail-label">Status</div>
                        <div class="detail-value {{ 'success' if flight.status == 'Confirmed' else 'pending' }}">
                            {{ flight.status or 'Pending' }}
                        </div>
                    </div>
                </div>

                <div class="travel-actions">
                    <button class="action-btn edit-btn" onclick="editTravel({{ flight.id }})" data-tooltip="Edit Flight">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="action-btn status-btn" onclick="toggleFlightStatus({{ flight.id }})" data-tooltip="Update Status">
                        <i class="fas fa-plane"></i>
                    </button>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Hotels Section -->
    <div class="widget">
        <div class="widget-header">
            <div>
                <h3 class="widget-title">
                    <i class="fas fa-hotel"></i>
                    Hotel Accommodations
                </h3>
                <p class="widget-subtitle">September 24-29, 2025 - Banff, AB</p>
            </div>
            <button class="action-btn add-btn" onclick="openAddHotelModal()" data-tooltip="Add Hotel">
                <i class="fas fa-plus"></i>
            </button>
        </div>

        <div class="travel-cards">
            {% for hotel in hotels %}
            <div class="travel-card hotel-card" data-travel-id="{{ hotel.id }}">
                <div class="travel-header">
                    <div class="hotel-info">
                        <div class="hotel-name">{{ hotel.provider }}</div>
                        <div class="hotel-address">{{ hotel.address }}</div>
                    </div>
                    <div class="hotel-rating">
                        <div class="stars">
                            {% for i in range(4) %}
                            <i class="fas fa-star"></i>
                            {% endfor %}
                            <i class="far fa-star"></i>
                        </div>
                    </div>
                </div>

                <div class="travel-details">
                    <div class="travel-detail">
                        <div class="detail-label">Check-in</div>
                        <div class="detail-value">{{ hotel.checkIn or 'TBD' }}</div>
                    </div>
                    <div class="travel-detail">
                        <div class="detail-label">Check-out</div>
                        <div class="detail-value">{{ hotel.checkOut or 'TBD' }}</div>
                    </div>
                    <div class="travel-detail">
                        <div class="detail-label">Room Type</div>
                        <div class="detail-value">{{ hotel.roomType or 'Standard' }}</div>
                    </div>
                    <div class="travel-detail">
                        <div class="detail-label">Confirmation</div>
                        <div class="detail-value editable" data-field="confirmation" data-id="{{ hotel.id }}">
                            {{ hotel.confirmationNumber or 'Pending' }}
                        </div>
                    </div>
                </div>

                <div class="travel-actions">
                    <button class="action-btn edit-btn" onclick="editTravel({{ hotel.id }})" data-tooltip="Edit Hotel">
                        <i class="fas fa-edit"></i>
                    </button>
                    {% if hotel.phone %}
                    <button class="action-btn phone-btn" onclick="callHotel('{{ hotel.phone }}')" data-tooltip="Call Hotel">
                        <i class="fas fa-phone"></i>
                    </button>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Ground Transportation Section -->
    <div class="widget">
        <div class="widget-header">
            <div>
                <h3 class="widget-title">
                    <i class="fas fa-car"></i>
                    Ground Transportation
                </h3>
                <p class="widget-subtitle">Rental car and local transport</p>
            </div>
            <button class="action-btn add-btn" onclick="openAddTransportModal()" data-tooltip="Add Transport">
                <i class="fas fa-plus"></i>
            </button>
        </div>

        <div class="travel-cards">
            {% for transport in ground_transport %}
            <div class="travel-card transport-card" data-travel-id="{{ transport.id }}">
                <div class="travel-header">
                    <div class="transport-info">
                        <div class="transport-provider">{{ transport.provider }}</div>
                        <div class="transport-location">{{ transport.location }}</div>
                        <div class="transport-type">
                            <i class="fas fa-car"></i>
                            {{ transport.carType.split('\n')[0] if transport.carType else 'Vehicle' }}
                        </div>
                    </div>
                </div>

                <div class="travel-details">
                    <div class="travel-detail">
                        <div class="detail-label">Pick-up</div>
                        <div class="detail-value">{{ transport.pickupDate if transport.pickupDate else 'TBD' }}</div>
                    </div>
                    <div class="travel-detail">
                        <div class="detail-label">Status</div>
                        <div class="detail-value {{ 'success' if transport.status == 'Confirmed' else 'pending' }}">
                            {{ transport.status or 'Pending' }}
                        </div>
                    </div>
                    <div class="travel-detail">
                        <div class="detail-label">Vehicle</div>
                        <div class="detail-value">{{ transport.carType.split('\n')[1] if transport.carType and '\n' in transport.carType else 'SUV' }}</div>
                    </div>
                    <div class="travel-detail">
                        <div class="detail-label">Confirmation</div>
                        <div class="detail-value editable" data-field="confirmation" data-id="{{ transport.id }}">
                            {{ transport.confirmationNumber or 'Pending' }}
                        </div>
                    </div>
                </div>

                <div class="travel-actions">
                    <button class="action-btn edit-btn" onclick="editTravel({{ transport.id }})" data-tooltip="Edit Rental">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="action-btn location-btn" onclick="showLocation('{{ transport.location }}')" data-tooltip="Show Location">
                        <i class="fas fa-map-marker-alt"></i>
                    </button>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<!-- Leaflet JavaScript -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js"></script>
<script src="{{ url_for('static', filename='js/travel.js') }}"></script>
{% endblock %}