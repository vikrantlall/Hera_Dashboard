{% extends "base.html" %}

{% block title %}Travel - HERA{% endblock %}
{% block page_title %}Travel Bookings{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/travel.css') }}">
{% endblock %}

{% block content %}
<div class="travel-container">
    <!-- Travel Overview -->
    <div class="travel-overview">
        <div class="overview-card">
            <div class="overview-icon">
                <i class="fas fa-plane"></i>
            </div>
            <div class="overview-content">
                <h2 class="overview-title">Journey to Forever</h2>
                <p class="overview-subtitle">All your travel arrangements for the perfect proposal</p>
                
                <div class="travel-stats">
                    <div class="stat-item">
                        <div class="stat-number">{{ travel_data|selectattr('status', 'equalto', 'Booked')|list|length }}</div>
                        <div class="stat-label">Confirmed</div>
                    </div>
                    <div class="stat-divider">/</div>
                    <div class="stat-item">
                        <div class="stat-number">{{ travel_data|length }}</div>
                        <div class="stat-label">Total</div>
                    </div>
                </div>
            </div>
            
            <div class="quick-actions">
                <button class="add-booking-btn" id="add-travel-booking">
                    <i class="fas fa-plus"></i>
                    Add Booking
                </button>
            </div>
        </div>
    </div>

    <!-- Travel Bookings Section -->
    <div class="travel-bookings-section">
        <div class="section-header">
            <h2 class="section-title">
                <i class="fas fa-suitcase"></i>
                Travel Bookings
            </h2>
            
            <div class="filter-controls">
                <button class="filter-btn active" data-filter="all">All</button>
                <button class="filter-btn" data-filter="flights">Flights</button>
                <button class="filter-btn" data-filter="hotels">Hotels</button>
                <button class="filter-btn" data-filter="transport">Transport</button>
            </div>
        </div>

        <div class="travel-bookings-grid" id="travel-bookings-grid">
            {% for booking in travel_data %}
            <div class="travel-booking-card" data-booking-id="{{ booking.id }}" data-type="{{ booking.type.lower() }}">
                <div class="booking-header">
                    <div class="booking-type-icon">
                        {% if booking.type == 'Flight' %}
                            <i class="fas fa-plane"></i>
                        {% elif booking.type == 'Hotel' %}
                            <i class="fas fa-bed"></i>
                        {% elif booking.type == 'Car Rental' %}
                            <i class="fas fa-car"></i>
                        {% elif booking.type == 'Train' %}
                            <i class="fas fa-train"></i>
                        {% else %}
                            <i class="fas fa-map-marker-alt"></i>
                        {% endif %}
                    </div>
                    
                    <div class="booking-info">
                        <h3 class="booking-type">
                            <span class="editable-text" data-field="type">{{ booking.type }}</span>
                        </h3>
                        <div class="booking-provider">
                            <span class="editable-text" data-field="provider" data-placeholder="Provider name">{{ booking.provider or 'Provider' }}</span>
                        </div>
                    </div>
                    
                    <div class="booking-actions">
                        <div class="action-menu">
                            <button class="menu-toggle">
                                <i class="fas fa-ellipsis-v"></i>
                            </button>
                            <div class="menu-dropdown">
                                <button class="menu-item edit-booking">
                                    <i class="fas fa-edit"></i>
                                    Edit Details
                                </button>
                                <button class="menu-item delete-booking">
                                    <i class="fas fa-trash"></i>
                                    Remove
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="booking-content">
                    <div class="booking-details-section">
                        <div class="details-header">
                            <h4 class="details-title">
                                <i class="fas fa-info-circle"></i>
                                Booking Details
                            </h4>
                        </div>
                        
                        <div class="details-content">
                            <div class="detail-field">
                                <label class="field-label">Details:</label>
                                <div class="editable-textarea" data-field="details" data-placeholder="Flight details, hotel room info, etc.">{{ booking.details or '' }}</div>
                            </div>
                            
                            <div class="detail-row">
                                <div class="detail-field">
                                    <label class="field-label">Date:</label>
                                    <input type="date" class="date-input" data-field="date" value="{{ booking.date.strftime('%Y-%m-%d') if booking.date else '' }}">
                                </div>
                                <div class="detail-field">
                                    <label class="field-label">Time:</label>
                                    <input type="time" class="time-input" data-field="time" value="{{ booking.time.strftime('%H:%M') if booking.time else '' }}">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="confirmation-section">
                        <div class="confirmation-header">
                            <h4 class="confirmation-title">
                                <i class="fas fa-ticket-alt"></i>
                                Confirmation
                            </h4>
                        </div>
                        <div class="confirmation-content">
                            <div class="confirmation-field">
                                <label class="field-label">Confirmation #:</label>
                                <div class="editable-text" data-field="confirmation" data-placeholder="Booking confirmation number">{{ booking.confirmation or '' }}</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="booking-footer">
                    <div class="cost-section">
                        <div class="cost-label">Cost:</div>
                        <div class="cost-amount">
                            <span class="currency-symbol">$</span>
                            <span class="editable-number" data-field="cost">{{ "%.2f"|format(booking.cost) }}</span>
                        </div>
                    </div>
                    
                    <div class="status-section">
                        <select class="status-select" data-field="status">
                            <option value="Booked" {% if booking.status == 'Booked' %}selected{% endif %}>✅ Booked</option>
                            <option value="Pending" {% if booking.status == 'Pending' %}selected{% endif %}>⏳ Pending</option>
                            <option value="Cancelled" {% if booking.status == 'Cancelled' %}selected{% endif %}>❌ Cancelled</option>
                        </select>
                    </div>
                    
                    <div class="last-updated">
                        <i class="fas fa-clock"></i>
                        <span>{{ booking.updated_at.strftime('%b %d, %Y') if booking.updated_at else 'Never updated' }}</span>
                    </div>
                </div>

                <div class="notes-section">
                    <div class="notes-header">
                        <h4 class="notes-title">
                            <i class="fas fa-sticky-note"></i>
                            Notes
                        </h4>
                    </div>
                    <div class="notes-content">
                        <div class="editable-textarea" data-field="notes" data-placeholder="Add any additional notes about this booking...">{{ booking.notes or '' }}</div>
                    </div>
                </div>
            </div>
            {% endfor %}

            {% if not travel_data %}
            <div class="empty-state">
                <div class="empty-icon">
                    <i class="fas fa-plane"></i>
                </div>
                <h3>No Travel Bookings Yet</h3>
                <p>Add your first travel booking to start planning your journey</p>
                <button class="btn btn-primary" id="add-first-booking">
                    <i class="fas fa-plus"></i>
                    Add First Booking
                </button>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Travel Insights -->
    <div class="travel-insights">
        <h2 class="insights-title">
            <i class="fas fa-chart-line"></i>
            Travel Overview
        </h2>
        
        <div class="insights-grid">
            <div class="insight-item">
                <div class="insight-icon flights">
                    <i class="fas fa-plane"></i>
                </div>
                <div class="insight-content">
                    <div class="insight-number">{{ travel_data|selectattr('type', 'equalto', 'Flight')|list|length }}</div>
                    <div class="insight-label">Flights</div>
                </div>
            </div>
            
            <div class="insight-item">
                <div class="insight-icon hotels">
                    <i class="fas fa-bed"></i>
                </div>
                <div class="insight-content">
                    <div class="insight-number">{{ travel_data|selectattr('type', 'equalto', 'Hotel')|list|length }}</div>
                    <div class="insight-label">Hotels</div>
                </div>
            </div>
            
            <div class="insight-item">
                <div class="insight-icon transport">
                    <i class="fas fa-car"></i>
                </div>
                <div class="insight-content">
                    <div class="insight-number">{{ travel_data|selectattr('type', 'equalto', 'Car Rental')|list|length }}</div>
                    <div class="insight-label">Transport</div>
                </div>
            </div>
            
            <div class="insight-item">
                <div class="insight-icon cost">
                    <i class="fas fa-dollar-sign"></i>
                </div>
                <div class="insight-content">
                    <div class="insight-number">${{ "%.0f"|format(travel_data|sum(attribute='cost')) }}</div>
                    <div class="insight-label">Total Cost</div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Add Travel Booking Modal -->
<div class="glass-overlay" id="add-booking-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">Add New Travel Booking</h3>
            <button class="modal-close" data-modal="add-booking-modal">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <form class="modal-form" id="add-booking-form">
            <div class="form-row">
                <div class="form-group">
                    <label for="booking-type">Type</label>
                    <select name="type" id="booking-type" required>
                        <option value="">Select booking type</option>
                        <option value="Flight">Flight</option>
                        <option value="Hotel">Hotel</option>
                        <option value="Car Rental">Car Rental</option>
                        <option value="Train">Train</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="booking-provider">Provider</label>
                    <input type="text" name="provider" id="booking-provider" placeholder="Airline, hotel chain, etc.">
                </div>
            </div>
            
            <div class="form-group">
                <label for="booking-details">Booking Details</label>
                <textarea name="details" id="booking-details" placeholder="Flight number, hotel room type, pickup location, etc." rows="3"></textarea>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="booking-date">Date</label>
                    <input type="date" name="date" id="booking-date">
                </div>
                
                <div class="form-group">
                    <label for="booking-time">Time</label>
                    <input type="time" name="time" id="booking-time">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="booking-confirmation">Confirmation Number</label>
                    <input type="text" name="confirmation" id="booking-confirmation" placeholder="Booking confirmation #">
                </div>
                
                <div class="form-group">
                    <label for="booking-cost">Cost</label>
                    <input type="number" name="cost" id="booking-cost" step="0.01" min="0" placeholder="0.00">
                </div>
            </div>
            
            <div class="form-group">
                <label for="booking-status">Status</label>
                <select name="status" id="booking-status">
                    <option value="Booked" selected>Booked</option>
                    <option value="Pending">Pending</option>
                    <option value="Cancelled">Cancelled</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="booking-notes">Notes</label>
                <textarea name="notes" id="booking-notes" placeholder="Additional notes about this booking..." rows="2"></textarea>
            </div>
            
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" data-modal="add-booking-modal">Cancel</button>
                <button type="submit" class="btn btn-primary">Add Booking</button>
            </div>
        </form>
    </div>
</div>

<!-- Delete Booking Modal -->
<div class="glass-overlay" id="delete-booking-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">Delete Travel Booking</h3>
            <button class="modal-close" data-modal="delete-booking-modal">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="modal-body">
            <p>Are you sure you want to delete this travel booking? This action cannot be undone.</p>
        </div>
        
        <div class="modal-actions">
            <button type="button" class="btn btn-secondary" data-modal="delete-booking-modal">Cancel</button>
            <button type="button" class="btn btn-danger" id="confirm-delete-booking">Delete Booking</button>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/travel.js') }}"></script>
{% endblock %}