{% extends "base.html" %}

{% block title %}HERA - Ring Details{% endblock %}

{% block page_title %}Ring Details{% endblock %}

{% block styles %}
<link href="{{ url_for('static', filename='css/ring.css') }}" rel="stylesheet">
{% endblock %}

{% block content %}
<!-- Ring Showcase -->
<div class="ring-showcase">
    <div class="ring-gallery">
        <div class="ring-main-image">
            {% if ring_images and ring_images|length > 0 %}
                <img src="{{ url_for('static', filename='uploads/ring/' + ring_images[0]) }}" alt="Engagement Ring" id="main-ring-image">
            {% else %}
                <div class="ring-image-placeholder">
                    <i class="fas fa-gem"></i>
                    <p>No images uploaded</p>
                </div>
            {% endif %}

            <div class="image-overlay">
                <button class="image-action-btn" onclick="openImageUpload('ring')" data-tooltip="Upload Images">
                    <i class="fas fa-camera"></i>
                </button>
                {% if ring_images and ring_images|length > 0 %}
                <button class="image-action-btn" onclick="openImageEditor()" data-tooltip="Edit Image">
                    <i class="fas fa-edit"></i>
                </button>
                {% endif %}
            </div>
        </div>

        {% if ring_images and ring_images|length > 1 %}
        <div class="ring-thumbnails">
            {% for image in ring_images %}
            <div class="ring-thumbnail {{ 'active' if loop.first else '' }}" onclick="changeMainImage('{{ image }}')">
                <img src="{{ url_for('static', filename='uploads/ring/' + image) }}" alt="Ring Image {{ loop.index }}">
            </div>
            {% endfor %}
        </div>
        {% endif %}
    </div>

    <div class="ring-details">
        <h2 class="ring-title">
            <span class="editable-text" data-field="stone" data-item-id="ring">{{ ring['Stone(s)'] }}</span>
            Ring
        </h2>
        <p class="ring-subtitle">
            <span class="editable-text" data-field="metal" data-item-id="ring">{{ ring.Metal }}</span> â€¢
            <span class="editable-text" data-field="jeweler" data-item-id="ring">{{ ring.Jeweler }}</span>
        </p>

        <div class="ring-specs">
            <div class="spec-item">
                <span class="spec-label">Jeweler</span>
                <span class="spec-value editable-text" data-field="jeweler" data-item-id="ring">{{ ring.Jeweler }}</span>
            </div>

            <div class="spec-item">
                <span class="spec-label">Metal</span>
                <span class="spec-value editable-text" data-field="metal" data-item-id="ring">{{ ring.Metal }}</span>
            </div>

            <div class="spec-item">
                <span class="spec-label">Stone</span>
                <span class="spec-value editable-text" data-field="stone" data-item-id="ring">{{ ring['Stone(s)'] }}</span>
            </div>

            <div class="spec-item">
                <span class="spec-label">Status</span>
                <span class="spec-value {{ 'text-success' if ring.Delivered == 'YES, delivered' else 'text-warning' }}">
                    <span class="editable-select" data-field="delivered" data-item-id="ring" data-options="YES, delivered|In Progress|Ordered">
                        {{ ring.Delivered }}
                    </span>
                </span>
            </div>

            <div class="spec-item">
                <span class="spec-label">Insured</span>
                <span class="spec-value editable-select" data-field="insured" data-item-id="ring" data-options="Yes|No">{{ ring.Insured }}</span>
            </div>

            <div class="spec-item">
                <span class="spec-label">Insurance Details</span>
                <span class="spec-value editable-text" data-field="insurance_details" data-item-id="ring">{{ ring['Insurance Details'] }}</span>
            </div>
        </div>

        <div class="ring-actions">
            <button class="btn btn-primary" onclick="openRingEditModal()">
                <i class="fas fa-edit"></i>
                Edit Details
            </button>
            <button class="btn btn-secondary" onclick="openImageUpload('ring')">
                <i class="fas fa-camera"></i>
                Manage Images
            </button>
        </div>
    </div>
</div>

<!-- Ring Status Timeline -->
<div class="widget">
    <div class="widget-header">
        <h3 class="widget-title">Ring Timeline</h3>
        <p class="widget-subtitle">Track progress from order to delivery</p>
    </div>

    <div class="timeline">
        <div class="timeline-item {{ 'completed' if ring['Order Placed'] else '' }}">
            <div class="timeline-icon">
                <i class="fas fa-shopping-cart"></i>
            </div>
            <div class="timeline-content">
                <div class="timeline-title">Order Placed</div>
                <div class="timeline-description">{{ ring['Order Placed'] or 'Not yet ordered' }}</div>
            </div>
        </div>

        <div class="timeline-item {{ 'completed' if ring['Design Approved'] == 'YES, 50% deposit placed' else '' }}">
            <div class="timeline-icon">
                <i class="fas fa-check-circle"></i>
            </div>
            <div class="timeline-content">
                <div class="timeline-title">Design Approved</div>
                <div class="timeline-description">{{ ring['Design Approved'] or 'Pending approval' }}</div>
            </div>
        </div>

        <div class="timeline-item {{ 'completed' if ring.Delivered == 'YES, delivered' else '' }}">
            <div class="timeline-icon">
                <i class="fas fa-gem"></i>
            </div>
            <div class="timeline-content">
                <div class="timeline-title">Delivered</div>
                <div class="timeline-description">{{ ring.Delivered or 'Not yet delivered' }}</div>
            </div>
        </div>

        <div class="timeline-item {{ 'completed' if ring.Insured == 'Yes' else '' }}">
            <div class="timeline-icon">
                <i class="fas fa-shield-alt"></i>
            </div>
            <div class="timeline-content">
                <div class="timeline-title">Insured</div>
                <div class="timeline-description">{{ ring['Insurance Details'] if ring.Insured == 'Yes' else 'Not yet insured' }}</div>
            </div>
        </div>
    </div>
</div>

<!-- Ring Notes -->
<div class="widget">
    <div class="widget-header">
        <h3 class="widget-title">Ring Notes & Updates</h3>
        <button class="action-btn add-btn" onclick="openAddNoteModal()" data-tooltip="Add Note">
            <i class="fas fa-plus"></i>
        </button>
    </div>

    <div class="ring-notes">
        <div class="note-item">
            <div class="note-content">
                <div class="note-text">{{ ring.Status }}</div>
            </div>
            <div class="note-actions">
                <button class="action-btn edit-btn" onclick="editNote(1)">
                    <i class="fas fa-edit"></i>
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Ring Edit Modal -->
<div id="ring-edit-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">Edit Ring Details</h3>
            <button class="modal-close" onclick="closeRingEditModal()">&times;</button>
        </div>
        <form id="ring-edit-form">
            <div class="modal-body">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Jeweler</label>
                        <input type="text" class="form-input" id="ring-jeweler" value="{{ ring.Jeweler }}">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Metal</label>
                        <input type="text" class="form-input" id="ring-metal" value="{{ ring.Metal }}">
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Stone(s)</label>
                    <input type="text" class="form-input" id="ring-stone" value="{{ ring['Stone(s)'] }}">
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Delivery Status</label>
                        <select class="form-select" id="ring-delivered">
                            <option value="YES, delivered" {{ 'selected' if ring.Delivered == 'YES, delivered' else '' }}>Delivered</option>
                            <option value="In Progress" {{ 'selected' if ring.Delivered == 'In Progress' else '' }}>In Progress</option>
                            <option value="Ordered" {{ 'selected' if ring.Delivered == 'Ordered' else '' }}>Ordered</option>
                            <option value="Not Ordered" {{ 'selected' if ring.Delivered == 'Not Ordered' else '' }}>Not Ordered</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Insured</label>
                        <select class="form-select" id="ring-insured">
                            <option value="Yes" {{ 'selected' if ring.Insured == 'Yes' else '' }}>Yes</option>
                            <option value="No" {{ 'selected' if ring.Insured == 'No' else '' }}>No</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Insurance Details</label>
                    <input type="text" class="form-input" id="ring-insurance-details" value="{{ ring['Insurance Details'] }}">
                </div>

                <div class="form-group">
                    <label class="form-label">Ring Style (Inspiration Link)</label>
                    <input type="url" class="form-input" id="ring-style" value="{{ ring['Ring Style (Inspiration)'] }}" placeholder="https://...">
                </div>

                <div class="form-group">
                    <label class="form-label">Engraving</label>
                    <input type="text" class="form-input" id="ring-engraving" value="{{ ring.Engraving or '' }}" placeholder="Custom engraving text">
                </div>

                <div class="form-group">
                    <label class="form-label">Status Notes</label>
                    <textarea class="form-textarea" id="ring-status" rows="4">{{ ring.Status }}</textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeRingEditModal()">Cancel</button>
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-save"></i>
                    Save Changes
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Add Note Modal -->
<div id="add-note-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">Add Ring Note</h3>
            <button class="modal-close" onclick="closeAddNoteModal()">&times;</button>
        </div>
        <form id="add-note-form">
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Note</label>
                    <textarea class="form-textarea" id="note-text" rows="4" placeholder="Enter your note about the ring..." required></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeAddNoteModal()">Cancel</button>
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-plus"></i>
                    Add Note
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Image Upload Modal for Ring -->
<div id="ring-image-modal" class="modal">
    <div class="modal-content modal-large">
        <div class="modal-header">
            <h3 class="modal-title">Manage Ring Images</h3>
            <button class="modal-close" onclick="closeRingImageModal()">&times;</button>
        </div>
        <div class="modal-body">
            <div class="image-upload-area" id="ring-image-upload" onclick="document.getElementById('ring-image-input').click()">
                <i class="fas fa-cloud-upload-alt"></i>
                <p>Drag & drop ring images here or click to browse</p>
                <input type="file" id="ring-image-input" accept="image/*" multiple>
            </div>

            <div class="current-images" id="current-ring-images">
                <h4 style="margin-bottom: 16px; color: var(--text-primary);">Current Images</h4>
                <div class="image-preview-grid">
                    {% for image in ring_images %}
                    <div class="image-preview" data-image="{{ image }}">
                        <img src="{{ url_for('static', filename='uploads/ring/' + image) }}" alt="Ring Image">
                        <button class="image-preview-remove" onclick="removeRingImage('{{ image }}')">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <div class="new-images" id="new-ring-images" style="display: none;">
                <h4 style="margin-bottom: 16px; color: var(--text-primary);">New Images to Upload</h4>
                <div class="image-preview-grid" id="ring-preview-grid"></div>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" onclick="closeRingImageModal()">Cancel</button>
            <button type="button" class="btn btn-primary" id="upload-ring-images-btn" onclick="uploadRingImages()">
                <i class="fas fa-upload"></i>
                Upload Images
            </button>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/ring.js') }}"></script>
<script>
    // Pass data to JavaScript
    window.RING_DATA = {{ ring | tojson }};
    window.RING_IMAGES = {{ ring_images | tojson }};
</script>
{% endblock %}