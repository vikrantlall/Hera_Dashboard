{% extends "base.html" %}

{% block title %}Packing - HERA{% endblock %}
{% block page_title %}Packing Checklist{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/packing.css') }}">
{% endblock %}

{% block content %}
<div class="packing-container">
    <!-- Packing Overview -->
    <div class="packing-overview">
        <div class="overview-card">
            <div class="overview-icon">
                <i class="fas fa-suitcase"></i>
            </div>
            <div class="overview-content">
                <h2 class="overview-title">Proposal Trip Packing</h2>
                <p class="overview-subtitle">Everything you need for the perfect weekend in Banff</p>
                
                <div class="packing-progress-section">
                    <div class="progress-stats">
                        <div class="stat-item">
                            <div class="stat-number">{{ packing_items|selectattr('packed')|list|length }}</div>
                            <div class="stat-label">Packed</div>
                        </div>
                        <div class="stat-divider">/</div>
                        <div class="stat-item">
                            <div class="stat-number">{{ packing_items|length }}</div>
                            <div class="stat-label">Total</div>
                        </div>
                    </div>
                    
                    <div class="progress-bar-container">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: {{ ((packing_items|selectattr('packed')|list|length / packing_items|length) * 100) if packing_items else 0 }}%"></div>
                        </div>
                        <div class="progress-percentage">{{ "%.0f"|format(((packing_items|selectattr('packed')|list|length / packing_items|length) * 100) if packing_items else 0) }}%</div>
                    </div>
                </div>
            </div>
            
            <div class="quick-actions">
                <button class="add-item-btn" id="add-packing-item">
                    <i class="fas fa-plus"></i>
                    Add Item
                </button>
            </div>
        </div>
    </div>

    <!-- Packing Categories -->
    <div class="packing-categories-section">
        <div class="section-header">
            <h2 class="section-title">
                <i class="fas fa-list-check"></i>
                Packing Checklist
            </h2>
            
            <div class="filter-controls">
                <button class="filter-btn active" data-filter="all">All Items</button>
                <button class="filter-btn" data-filter="packed">Packed</button>
                <button class="filter-btn" data-filter="unpacked">To Pack</button>
                <button class="filter-btn" data-filter="high">High Priority</button>
            </div>
        </div>

        {% set categories = packing_items|groupby('category')|list %}
        <div class="packing-categories" id="packing-categories">
            {% for category, items in categories %}
            <div class="category-section" data-category="{{ category.lower().replace(' ', '-') }}">
                <div class="category-header">
                    <div class="category-icon">
                        {% if category == 'Clothing' %}
                            <i class="fas fa-tshirt"></i>
                        {% elif category == 'Electronics' %}
                            <i class="fas fa-laptop"></i>
                        {% elif category == 'Toiletries' %}
                            <i class="fas fa-pump-soap"></i>
                        {% elif category == 'Documents' %}
                            <i class="fas fa-passport"></i>
                        {% elif category == 'Accessories' %}
                            <i class="fas fa-watch"></i>
                        {% elif category == 'Proposal' %}
                            <i class="fas fa-gem"></i>
                        {% else %}
                            <i class="fas fa-box"></i>
                        {% endif %}
                    </div>
                    
                    <div class="category-info">
                        <h3 class="category-title">{{ category }}</h3>
                        <div class="category-progress">
                            {{ items|selectattr('packed')|list|length }}/{{ items|length }} packed
                        </div>
                    </div>
                    
                    <div class="category-actions">
                        <button class="category-toggle" data-category="{{ category.lower().replace(' ', '-') }}">
                            <i class="fas fa-chevron-down"></i>
                        </button>
                    </div>
                </div>

                <div class="category-items" data-category="{{ category.lower().replace(' ', '-') }}">
                    {% for item in items|sort(attribute='priority', reverse=true) %}
                    <div class="packing-item" data-item-id="{{ item.id }}" data-priority="{{ item.priority.lower() }}" data-packed="{{ 'true' if item.packed else 'false' }}">
                        <div class="item-checkbox-section">
                            <label class="checkbox-container">
                                <input type="checkbox" class="item-checkbox" {% if item.packed %}checked{% endif %}>
                                <span class="checkmark"></span>
                            </label>
                        </div>
                        
                        <div class="item-content">
                            <div class="item-header">
                                <div class="item-info">
                                    <h4 class="item-name">
                                        <span class="editable-text" data-field="item">{{ item.item }}</span>
                                        {% if item.quantity > 1 %}
                                            <span class="item-quantity">
                                                x<span class="editable-number" data-field="quantity">{{ item.quantity }}</span>
                                            </span>
                                        {% endif %}
                                    </h4>
                                    
                                    <div class="item-meta">
                                        <div class="priority-badge priority-{{ item.priority.lower() }}">
                                            {% if item.priority == 'High' %}
                                                <i class="fas fa-exclamation"></i>
                                            {% elif item.priority == 'Medium' %}
                                                <i class="fas fa-circle"></i>
                                            {% else %}
                                                <i class="fas fa-minus"></i>
                                            {% endif %}
                                            {{ item.priority }}
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="item-actions">
                                    <div class="priority-selector">
                                        <select class="priority-select" data-field="priority">
                                            <option value="High" {% if item.priority == 'High' %}selected{% endif %}>High</option>
                                            <option value="Medium" {% if item.priority == 'Medium' %}selected{% endif %}>Medium</option>
                                            <option value="Low" {% if item.priority == 'Low' %}selected{% endif %}>Low</option>
                                        </select>
                                    </div>
                                    
                                    <div class="action-menu">
                                        <button class="menu-toggle">
                                            <i class="fas fa-ellipsis-v"></i>
                                        </button>
                                        <div class="menu-dropdown">
                                            <button class="menu-item edit-item">
                                                <i class="fas fa-edit"></i>
                                                Edit
                                            </button>
                                            <button class="menu-item delete-item">
                                                <i class="fas fa-trash"></i>
                                                Delete
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            {% if item.notes %}
                            <div class="item-notes">
                                <div class="notes-content">
                                    <div class="editable-textarea" data-field="notes" data-placeholder="Add notes about this item...">{{ item.notes }}</div>
                                </div>
                            </div>
                            {% endif %}
                        </div>
                        
                        <div class="item-status">
                            {% if item.packed %}
                                <div class="packed-indicator">
                                    <i class="fas fa-check-circle"></i>
                                    <span>Packed</span>
                                </div>
                            {% else %}
                                <div class="unpacked-indicator">
                                    <i class="fas fa-circle"></i>
                                    <span>To Pack</span>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endfor %}
            
            {% if not packing_items %}
            <div class="empty-state">
                <div class="empty-icon">
                    <i class="fas fa-suitcase"></i>
                </div>
                <h3>No Packing Items Yet</h3>
                <p>Start building your packing checklist for the perfect proposal trip</p>
                <button class="btn btn-primary" id="add-first-item">
                    <i class="fas fa-plus"></i>
                    Add First Item
                </button>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Packing Insights -->
    <div class="packing-insights">
        <h2 class="insights-title">
            <i class="fas fa-chart-pie"></i>
            Packing Progress
        </h2>
        
        <div class="insights-grid">
            <div class="insight-item">
                <div class="insight-icon high-priority">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <div class="insight-content">
                    <div class="insight-number">{{ packing_items|selectattr('priority', 'equalto', 'High')|list|length }}</div>
                    <div class="insight-label">High Priority</div>
                </div>
            </div>
            
            <div class="insight-item">
                <div class="insight-icon categories">
                    <i class="fas fa-layer-group"></i>
                </div>
                <div class="insight-content">
                    <div class="insight-number">{{ packing_items|groupby('category')|list|length }}</div>
                    <div class="insight-label">Categories</div>
                </div>
            </div>
            
            <div class="insight-item">
                <div class="insight-icon remaining">
                    <i class="fas fa-clock"></i>
                </div>
                <div class="insight-content">
                    <div class="insight-number">{{ packing_items|rejectattr('packed')|list|length }}</div>
                    <div class="insight-label">Still To Pack</div>
                </div>
            </div>
            
            <div class="insight-item">
                <div class="insight-icon completion">
                    <i class="fas fa-check-double"></i>
                </div>
                <div class="insight-content">
                    <div class="insight-number">{{ "%.0f"|format(((packing_items|selectattr('packed')|list|length / packing_items|length) * 100) if packing_items else 0) }}%</div>
                    <div class="insight-label">Complete</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Add Section -->
    <div class="quick-add-section">
        <h3 class="quick-add-title">
            <i class="fas fa-magic"></i>
            Quick Add Common Items
        </h3>
        
        <div class="quick-add-categories">
            <div class="quick-category" data-category="Clothing">
                <h4>Clothing</h4>
                <div class="quick-items">
                    <button class="quick-item" data-item="Formal shirt" data-priority="High">Formal shirt</button>
                    <button class="quick-item" data-item="Dress pants" data-priority="High">Dress pants</button>
                    <button class="quick-item" data-item="Warm jacket" data-priority="High">Warm jacket</button>
                    <button class="quick-item" data-item="Comfortable shoes" data-priority="Medium">Comfortable shoes</button>
                </div>
            </div>
            
            <div class="quick-category" data-category="Proposal">
                <h4>Proposal Essentials</h4>
                <div class="quick-items">
                    <button class="quick-item" data-item="The Ring" data-priority="High">The Ring 💍</button>
                    <button class="quick-item" data-item="Ring box" data-priority="High">Ring box</button>
                    <button class="quick-item" data-item="Speech notes" data-priority="Medium">Speech notes</button>
                    <button class="quick-item" data-item="Camera for photos" data-priority="Medium">Camera</button>
                </div>
            </div>
            
            <div class="quick-category" data-category="Documents">
                <h4>Documents</h4>
                <div class="quick-items">
                    <button class="quick-item" data-item="ID/Passport" data-priority="High">ID/Passport</button>
                    <button class="quick-item" data-item="Travel insurance" data-priority="Medium">Travel insurance</button>
                    <button class="quick-item" data-item="Hotel confirmations" data-priority="Medium">Hotel confirmations</button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Add Packing Item Modal -->
<div class="glass-overlay" id="add-item-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">Add Packing Item</h3>
            <button class="modal-close" data-modal="add-item-modal">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <form class="modal-form" id="add-item-form">
            <div class="form-row">
                <div class="form-group">
                    <label for="item-category">Category</label>
                    <select name="category" id="item-category" required>
                        <option value="">Select category</option>
                        <option value="Clothing">Clothing</option>
                        <option value="Electronics">Electronics</option>
                        <option value="Toiletries">Toiletries</option>
                        <option value="Documents">Documents</option>
                        <option value="Accessories">Accessories</option>
                        <option value="Proposal">Proposal Essentials</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="item-priority">Priority</label>
                    <select name="priority" id="item-priority" required>
                        <option value="Medium" selected>Medium</option>
                        <option value="High">High</option>
                        <option value="Low">Low</option>
                    </select>
                </div>
            </div>
            
            <div class="form-group">
                <label for="item-name">Item Name</label>
                <input type="text" name="item" id="item-name" placeholder="What do you need to pack?" required>
            </div>
            
            <div class="form-group">
                <label for="item-quantity">Quantity</label>
                <input type="number" name="quantity" id="item-quantity" min="1" value="1">
            </div>
            
            <div class="form-group">
                <label for="item-notes">Notes</label>
                <textarea name="notes" id="item-notes" placeholder="Any special notes about this item..." rows="2"></textarea>
            </div>
            
            <div class="form-group">
                <label>
                    <input type="checkbox" name="packed" id="item-packed">
                    Already packed
                </label>
            </div>
            
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" data-modal="add-item-modal">Cancel</button>
                <button type="submit" class="btn btn-primary">Add Item</button>
            </div>
        </form>
    </div>
</div>

<!-- Delete Item Modal -->
<div class="glass-overlay" id="delete-item-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">Delete Packing Item</h3>
            <button class="modal-close" data-modal="delete-item-modal">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="modal-body">
            <p>Are you sure you want to delete this packing item? This action cannot be undone.</p>
        </div>
        
        <div class="modal-actions">
            <button type="button" class="btn btn-secondary" data-modal="delete-item-modal">Cancel</button>
            <button type="button" class="btn btn-danger" id="confirm-delete-item">Delete Item</button>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/packing.js') }}"></script>
{% endblock %}