{% extends "base.html" %}

{% block title %}HERA - Trip Itinerary{% endblock %}

{% block page_title %}Trip Itinerary{% endblock %}

{% block styles %}
<link href="{{ url_for('static', filename='css/itinerary.css') }}" rel="stylesheet">
{% endblock %}

{% block content %}
<!-- Itinerary Overview -->
<div class="widget">
    <div class="widget-header">
        <div>
            <h2 class="widget-title">Trip Itinerary</h2>
            <p class="widget-subtitle">{{ total_activities }} activities across 6 days ‚Ä¢ September 24-29, 2025</p>
        </div>
        <div class="widget-actions">
            <button class="action-btn add-btn" onclick="openAddActivityModal()" data-tooltip="Add Activity">
                <i class="fas fa-plus"></i>
            </button>
        </div>
    </div>

    <!-- Trip Progress -->
    <div class="trip-progress">
        <div class="progress-info">
            <span class="progress-label">Trip Progress</span>
            <span class="progress-percentage" id="trip-percentage">0%</span>
        </div>
        <div class="progress-bar">
            <div class="progress-fill" id="trip-progress-fill"></div>
        </div>
    </div>
</div>

<!-- Days Grid -->
<div class="days-grid">
    <!-- Day 1: Arrival -->
    <div class="day-card" data-day="1">
        <div class="day-header">
            <div class="day-info">
                <h3 class="day-title">Day 1 - September 24th</h3>
                <p class="day-subtitle">Arrival & Check-in</p>
            </div>
            <div class="day-progress">
                <div class="day-progress-bar">
                    <div class="day-progress-fill" data-day="1"></div>
                </div>
                <span class="day-completion" data-day="1">0/0</span>
            </div>
        </div>

        <div class="activities-list" data-day="1">
            {% for activity in itinerary_items %}
                {% if activity.day == 1 %}
                <div class="activity-item {{ 'proposal-activity' if activity.isProposal else '' }}"
                     data-activity-id="{{ activity.id }}"
                     data-completed="{{ 'true' if activity.get('completed') else 'false' }}">
                    <div class="activity-checkbox">
                        <input type="checkbox" {{ 'checked' if activity.get('completed') else '' }}>
                    </div>

                    <div class="activity-content">
                        <div class="activity-time">{{ activity.time }}</div>
                        <div class="activity-details">
                            <h4 class="activity-title editable-text" data-field="activity" data-item-id="{{ activity.id }}">
                                {{ activity.activity }}
                                {% if activity.isProposal %}<span class="proposal-indicator">üíç</span>{% endif %}
                            </h4>
                            {% if activity.location %}
                            <div class="activity-location">
                                <i class="fas fa-map-marker-alt"></i>
                                <span class="editable-text" data-field="location" data-item-id="{{ activity.id }}">{{ activity.location }}</span>
                            </div>
                            {% endif %}
                            {% if activity.notes %}
                            <div class="activity-notes">
                                <p class="editable-text" data-field="notes" data-item-id="{{ activity.id }}">{{ activity.notes }}</p>
                            </div>
                            {% endif %}
                        </div>
                    </div>

                    <div class="activity-actions">
                        <button class="action-btn edit-btn" data-tooltip="Edit">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn delete-btn" data-tooltip="Delete">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
                {% endif %}
            {% endfor %}
        </div>
    </div>

    <!-- Day 2: Banff -->
    <div class="day-card" data-day="2">
        <div class="day-header">
            <div class="day-info">
                <h3 class="day-title">Day 2 - September 25th</h3>
                <p class="day-subtitle">Exploring Banff</p>
            </div>
            <div class="day-progress">
                <div class="day-progress-bar">
                    <div class="day-progress-fill" data-day="2"></div>
                </div>
                <span class="day-completion" data-day="2">0/0</span>
            </div>
        </div>

        <div class="activities-list" data-day="2">
            {% for activity in itinerary_items %}
                {% if activity.day == 2 %}
                <div class="activity-item {{ 'proposal-activity' if activity.isProposal else '' }}"
                     data-activity-id="{{ activity.id }}"
                     data-completed="{{ 'true' if activity.get('completed') else 'false' }}">
                    <div class="activity-checkbox">
                        <input type="checkbox" {{ 'checked' if activity.get('completed') else '' }}>
                    </div>

                    <div class="activity-content">
                        <div class="activity-time">{{ activity.time }}</div>
                        <div class="activity-details">
                            <h4 class="activity-title editable-text" data-field="activity" data-item-id="{{ activity.id }}">
                                {{ activity.activity }}
                                {% if activity.isProposal %}<span class="proposal-indicator">üíç</span>{% endif %}
                            </h4>
                            {% if activity.location %}
                            <div class="activity-location">
                                <i class="fas fa-map-marker-alt"></i>
                                <span class="editable-text" data-field="location" data-item-id="{{ activity.id }}">{{ activity.location }}</span>
                            </div>
                            {% endif %}
                            {% if activity.notes %}
                            <div class="activity-notes">
                                <p class="editable-text" data-field="notes" data-item-id="{{ activity.id }}">{{ activity.notes }}</p>
                            </div>
                            {% endif %}
                        </div>
                    </div>

                    <div class="activity-actions">
                        <button class="action-btn edit-btn" data-tooltip="Edit">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn delete-btn" data-tooltip="Delete">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
                {% endif %}
            {% endfor %}
        </div>
    </div>

    <!-- Day 3: PROPOSAL DAY! -->
    <div class="day-card proposal-day" data-day="3">
        <div class="day-header">
            <div class="day-info">
                <h3 class="day-title">
                    Day 3 - September 26th
                    <span class="proposal-badge">
                        <i class="fas fa-heart"></i>
                        THE BIG DAY!
                    </span>
                </h3>
                <p class="day-subtitle">Proposal Day at Emerald Lake</p>
            </div>
            <div class="day-progress">
                <div class="day-progress-bar">
                    <div class="day-progress-fill" data-day="3"></div>
                </div>
                <span class="day-completion" data-day="3">0/0</span>
            </div>
        </div>

        <div class="activities-list" data-day="3">
            {% for activity in itinerary_items %}
                {% if activity.day == 3 %}
                <div class="activity-item {{ 'proposal-activity' if activity.isProposal else '' }}"
                     data-activity-id="{{ activity.id }}"
                     data-completed="{{ 'true' if activity.get('completed') else 'false' }}">
                    <div class="activity-checkbox">
                        <input type="checkbox" {{ 'checked' if activity.get('completed') else '' }}>
                    </div>

                    <div class="activity-content">
                        <div class="activity-time">{{ activity.time }}</div>
                        <div class="activity-details">
                            <h4 class="activity-title editable-text" data-field="activity" data-item-id="{{ activity.id }}">
                                {{ activity.activity }}
                                {% if activity.isProposal %}<span class="proposal-indicator">üíç</span>{% endif %}
                            </h4>
                            {% if activity.location %}
                            <div class="activity-location">
                                <i class="fas fa-map-marker-alt"></i>
                                <span class="editable-text" data-field="location" data-item-id="{{ activity.id }}">{{ activity.location }}</span>
                            </div>
                            {% endif %}
                            {% if activity.notes %}
                            <div class="activity-notes">
                                <p class="editable-text" data-field="notes" data-item-id="{{ activity.id }}">{{ activity.notes }}</p>
                            </div>
                            {% endif %}
                        </div>
                    </div>

                    <div class="activity-actions">
                        <button class="action-btn edit-btn" data-tooltip="Edit">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn delete-btn" data-tooltip="Delete">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
                {% endif %}
            {% endfor %}
        </div>
    </div>

    <!-- Day 4: Lake Adventures -->
    <div class="day-card" data-day="4">
        <div class="day-header">
            <div class="day-info">
                <h3 class="day-title">Day 4 - September 27th</h3>
                <p class="day-subtitle">Lake Minnewanka & Louise</p>
            </div>
            <div class="day-progress">
                <div class="day-progress-bar">
                    <div class="day-progress-fill" data-day="4"></div>
                </div>
                <span class="day-completion" data-day="4">0/0</span>
            </div>
        </div>

        <div class="activities-list" data-day="4">
            {% for activity in itinerary_items %}
                {% if activity.day == 4 %}
                <div class="activity-item {{ 'proposal-activity' if activity.isProposal else '' }}"
                     data-activity-id="{{ activity.id }}"
                     data-completed="{{ 'true' if activity.get('completed') else 'false' }}">
                    <div class="activity-checkbox">
                        <input type="checkbox" {{ 'checked' if activity.get('completed') else '' }}>
                    </div>

                    <div class="activity-content">
                        <div class="activity-time">{{ activity.time }}</div>
                        <div class="activity-details">
                            <h4 class="activity-title editable-text" data-field="activity" data-item-id="{{ activity.id }}">
                                {{ activity.activity }}
                                {% if activity.isProposal %}<span class="proposal-indicator">üíç</span>{% endif %}
                            </h4>
                            {% if activity.location %}
                            <div class="activity-location">
                                <i class="fas fa-map-marker-alt"></i>
                                <span class="editable-text" data-field="location" data-item-id="{{ activity.id }}">{{ activity.location }}</span>
                            </div>
                            {% endif %}
                            {% if activity.notes %}
                            <div class="activity-notes">
                                <p class="editable-text" data-field="notes" data-item-id="{{ activity.id }}">{{ activity.notes }}</p>
                            </div>
                            {% endif %}
                        </div>
                    </div>

                    <div class="activity-actions">
                        <button class="action-btn edit-btn" data-tooltip="Edit">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn delete-btn" data-tooltip="Delete">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
                {% endif %}
            {% endfor %}
        </div>
    </div>

    <!-- Day 5: Scenic Routes -->
    <div class="day-card" data-day="5">
        <div class="day-header">
            <div class="day-info">
                <h3 class="day-title">Day 5 - September 28th</h3>
                <p class="day-subtitle">Scenic Drives & Views</p>
            </div>
            <div class="day-progress">
                <div class="day-progress-bar">
                    <div class="day-progress-fill" data-day="5"></div>
                </div>
                <span class="day-completion" data-day="5">0/0</span>
            </div>
        </div>

        <div class="activities-list" data-day="5">
            {% for activity in itinerary_items %}
                {% if activity.day == 5 %}
                <div class="activity-item {{ 'proposal-activity' if activity.isProposal else '' }}"
                     data-activity-id="{{ activity.id }}"
                     data-completed="{{ 'true' if activity.get('completed') else 'false' }}">
                    <div class="activity-checkbox">
                        <input type="checkbox" {{ 'checked' if activity.get('completed') else '' }}>
                    </div>

                    <div class="activity-content">
                        <div class="activity-time">{{ activity.time }}</div>
                        <div class="activity-details">
                            <h4 class="activity-title editable-text" data-field="activity" data-item-id="{{ activity.id }}">
                                {{ activity.activity }}
                                {% if activity.isProposal %}<span class="proposal-indicator">üíç</span>{% endif %}
                            </h4>
                            {% if activity.location %}
                            <div class="activity-location">
                                <i class="fas fa-map-marker-alt"></i>
                                <span class="editable-text" data-field="location" data-item-id="{{ activity.id }}">{{ activity.location }}</span>
                            </div>
                            {% endif %}
                            {% if activity.notes %}
                            <div class="activity-notes">
                                <p class="editable-text" data-field="notes" data-item-id="{{ activity.id }}">{{ activity.notes }}</p>
                            </div>
                            {% endif %}
                        </div>
                    </div>

                    <div class="activity-actions">
                        <button class="action-btn edit-btn" data-tooltip="Edit">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn delete-btn" data-tooltip="Delete">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
                {% endif %}
            {% endfor %}
        </div>
    </div>

    <!-- Day 6: Departure -->
    <div class="day-card" data-day="6">
        <div class="day-header">
            <div class="day-info">
                <h3 class="day-title">Day 6 - September 29th</h3>
                <p class="day-subtitle">Departure Day</p>
            </div>
            <div class="day-progress">
                <div class="day-progress-bar">
                    <div class="day-progress-fill" data-day="6"></div>
                </div>
                <span class="day-completion" data-day="6">0/0</span>
            </div>
        </div>

        <div class="activities-list" data-day="6">
            {% for activity in itinerary_items %}
                {% if activity.day == 6 %}
                <div class="activity-item {{ 'proposal-activity' if activity.isProposal else '' }}"
                     data-activity-id="{{ activity.id }}"
                     data-completed="{{ 'true' if activity.get('completed') else 'false' }}">
                    <div class="activity-checkbox">
                        <input type="checkbox" {{ 'checked' if activity.get('completed') else '' }}>
                    </div>

                    <div class="activity-content">
                        <div class="activity-time">{{ activity.time }}</div>
                        <div class="activity-details">
                            <h4 class="activity-title editable-text" data-field="activity" data-item-id="{{ activity.id }}">
                                {{ activity.activity }}
                                {% if activity.isProposal %}<span class="proposal-indicator">üíç</span>{% endif %}
                            </h4>
                            {% if activity.location %}
                            <div class="activity-location">
                                <i class="fas fa-map-marker-alt"></i>
                                <span class="editable-text" data-field="location" data-item-id="{{ activity.id }}">{{ activity.location }}</span>
                            </div>
                            {% endif %}
                            {% if activity.notes %}
                            <div class="activity-notes">
                                <p class="editable-text" data-field="notes" data-item-id="{{ activity.id }}">{{ activity.notes }}</p>
                            </div>
                            {% endif %}
                        </div>
                    </div>

                    <div class="activity-actions">
                        <button class="action-btn edit-btn" data-tooltip="Edit">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn delete-btn" data-tooltip="Delete">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
                {% endif %}
            {% endfor %}
        </div>
    </div>
</div>

<!-- Add Activity Modal -->
<div id="add-activity-modal" class="modal">
    <div class="modal-backdrop" onclick="closeModal('add-activity-modal')"></div>
    <div class="modal-content">
        <div class="modal-header">
            <h3>Add New Activity</h3>
            <button class="modal-close" onclick="closeModal('add-activity-modal')">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <form id="add-activity-form" class="modal-form">
            <div class="form-group">
                <label for="activity-day">Day</label>
                <select id="activity-day" name="day" required>
                    <option value="1">Day 1 - Sep 24 (Arrival)</option>
                    <option value="2">Day 2 - Sep 25 (Banff)</option>
                    <option value="3">Day 3 - Sep 26 (Proposal Day)</option>
                    <option value="4">Day 4 - Sep 27 (Lakes)</option>
                    <option value="5">Day 5 - Sep 28 (Scenic)</option>
                    <option value="6">Day 6 - Sep 29 (Departure)</option>
                </select>
            </div>

            <div class="form-group form-row">
                <div>
                    <label for="activity-time">Time</label>
                    <input type="time" id="activity-time" name="time" required>
                </div>
                <div>
                    <label for="is-proposal">Special Activity</label>
                    <div class="checkbox-group">
                        <input type="checkbox" id="is-proposal" name="isProposal">
                        <label for="is-proposal">Proposal Activity üíç</label>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label for="activity-name">Activity Name</label>
                <input type="text" id="activity-name" name="activity" placeholder="What are you doing?" required>
            </div>

            <div class="form-group">
                <label for="activity-location">Location</label>
                <input type="text" id="activity-location" name="location" placeholder="Where is this happening?">
            </div>

            <div class="form-group">
                <label for="activity-notes">Notes</label>
                <textarea id="activity-notes" name="notes" placeholder="Any additional details..."></textarea>
            </div>

            <div class="form-actions">
                <button type="button" class="btn btn-secondary" onclick="closeModal('add-activity-modal')">Cancel</button>
                <button type="submit" class="btn btn-primary">Add Activity</button>
            </div>
        </form>
    </div>
</div>

<!-- Edit Activity Modal -->
<div id="edit-activity-modal" class="modal">
    <div class="modal-backdrop" onclick="closeModal('edit-activity-modal')"></div>
    <div class="modal-content">
        <div class="modal-header">
            <h3>Edit Activity</h3>
            <button class="modal-close" onclick="closeModal('edit-activity-modal')">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <form id="edit-activity-form" class="modal-form">
            <input type="hidden" id="edit-activity-id" name="id">

            <div class="form-group">
                <label for="edit-activity-day">Day</label>
                <select id="edit-activity-day" name="day" required>
                    <option value="1">Day 1 - Sep 24 (Arrival)</option>
                    <option value="2">Day 2 - Sep 25 (Banff)</option>
                    <option value="3">Day 3 - Sep 26 (Proposal Day)</option>
                    <option value="4">Day 4 - Sep 27 (Lakes)</option>
                    <option value="5">Day 5 - Sep 28 (Scenic)</option>
                    <option value="6">Day 6 - Sep 29 (Departure)</option>
                </select>
            </div>

            <div class="form-group form-row">
                <div>
                    <label for="edit-activity-time">Time</label>
                    <input type="time" id="edit-activity-time" name="time" required>
                </div>
                <div>
                    <label for="edit-is-proposal">Special Activity</label>
                    <div class="checkbox-group">
                        <input type="checkbox" id="edit-is-proposal" name="isProposal">
                        <label for="edit-is-proposal">Proposal Activity üíç</label>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label for="edit-activity-name">Activity Name</label>
                <input type="text" id="edit-activity-name" name="activity" placeholder="What are you doing?" required>
            </div>

            <div class="form-group">
                <label for="edit-activity-location">Location</label>
                <input type="text" id="edit-activity-location" name="location" placeholder="Where is this happening?">
            </div>

            <div class="form-group">
                <label for="edit-activity-notes">Notes</label>
                <textarea id="edit-activity-notes" name="notes" placeholder="Any additional details..."></textarea>
            </div>

            <div class="form-actions">
                <button type="button" class="btn btn-secondary" onclick="closeModal('edit-activity-modal')">Cancel</button>
                <button type="submit" class="btn btn-primary">Save Changes</button>
            </div>
        </form>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/itinerary.js') }}"></script>
{% endblock %}