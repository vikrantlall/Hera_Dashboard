{% extends "base.html" %}

{% block title %}Itinerary - HERA{% endblock %}
{% block page_title %}Proposal Itinerary{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/itinerary.css') }}">
{% endblock %}

{% block content %}
<div class="itinerary-container">
    <!-- Itinerary Hero -->
    <div class="itinerary-hero">
        <div class="hero-content">
            <div class="proposal-highlight">
                <div class="highlight-icon">
                    <i class="fas fa-heart"></i>
                </div>
                <div class="highlight-content">
                    <h2 class="hero-title">The Perfect Proposal Journey</h2>
                    <p class="hero-subtitle">Every moment planned for September 24-26, 2025 at Emerald Lake, Banff</p>
                    
                    <div class="special-day-banner">
                        <div class="banner-icon">
                            <i class="fas fa-gem"></i>
                        </div>
                        <div class="banner-text">
                            <strong>September 26, 2025</strong> - The Proposal Day
                        </div>
                        <div class="banner-sparkle">‚ú®</div>
                    </div>
                </div>
                
                <div class="quick-actions">
                    <button class="add-activity-btn" id="add-itinerary-activity">
                        <i class="fas fa-plus"></i>
                        Add Activity
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Itinerary Timeline -->
    <div class="itinerary-timeline-section">
        <div class="section-header">
            <h2 class="section-title">
                <i class="fas fa-route"></i>
                Complete Itinerary
            </h2>
            
            <div class="timeline-controls">
                <button class="timeline-btn active" data-view="all">All Days</button>
                <button class="timeline-btn" data-view="day1">Sept 24</button>
                <button class="timeline-btn" data-view="day2">Sept 25</button>
                <button class="timeline-btn proposal-day-btn" data-view="day3">Sept 26 üíç</button>
            </div>
        </div>

        <div class="itinerary-timeline" id="itinerary-timeline">
            {% set days = itinerary_items|groupby('day')|list %}
            {% for day_num, activities in days %}
            <div class="timeline-day" data-day="{{ day_num }}" {% if day_num == 3 %}data-special="proposal"{% endif %}>
                <div class="day-header">
                    <div class="day-marker">
                        {% if day_num == 1 %}
                            <div class="day-icon arrival">
                                <i class="fas fa-plane-arrival"></i>
                            </div>
                            <h3 class="day-title">Day 1 - Arrival</h3>
                            <p class="day-subtitle">September 24, 2025</p>
                        {% elif day_num == 2 %}
                            <div class="day-icon explore">
                                <i class="fas fa-mountain"></i>
                            </div>  
                            <h3 class="day-title">Day 2 - Exploration</h3>
                            <p class="day-subtitle">September 25, 2025</p>
                        {% elif day_num == 3 %}
                            <div class="day-icon proposal">
                                <i class="fas fa-gem"></i>
                            </div>
                            <h3 class="day-title">Day 3 - The Proposal! üíç</h3>
                            <p class="day-subtitle">September 26, 2025 - The Big Day</p>
                        {% endif %}
                    </div>
                </div>

                <div class="day-activities" data-day="{{ day_num }}">
                    {% for activity in activities|sort(attribute='start_time') %}
                    <div class="activity-card" data-activity-id="{{ activity.id }}" {% if activity.special %}data-special="true"{% endif %}>
                        <div class="activity-timeline-marker">
                            <div class="timeline-dot {% if activity.special %}special{% endif %}"></div>
                            <div class="timeline-line"></div>
                        </div>
                        
                        <div class="activity-content">
                            <div class="activity-header">
                                <div class="activity-time">
                                    <input type="time" class="time-input" data-field="start_time" value="{{ activity.start_time.strftime('%H:%M') if activity.start_time else '' }}">
                                    <span class="time-separator">-</span>
                                    <input type="time" class="time-input" data-field="end_time" value="{{ activity.end_time.strftime('%H:%M') if activity.end_time else '' }}">
                                </div>
                                
                                <div class="activity-actions">
                                    <div class="action-menu">
                                        <button class="menu-toggle">
                                            <i class="fas fa-ellipsis-v"></i>
                                        </button>
                                        <div class="menu-dropdown">
                                            <button class="menu-item edit-activity">
                                                <i class="fas fa-edit"></i>
                                                Edit
                                            </button>
                                            <button class="menu-item toggle-special">
                                                <i class="fas fa-star"></i>
                                                {% if activity.special %}Remove Special{% else %}Mark Special{% endif %}
                                            </button>
                                            <button class="menu-item delete-activity">
                                                <i class="fas fa-trash"></i>
                                                Delete
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="activity-info">
                                <h4 class="activity-title">
                                    <span class="editable-text" data-field="activity">{{ activity.activity }}</span>
                                    {% if activity.special %}
                                        <span class="special-badge">
                                            <i class="fas fa-star"></i>
                                            Special
                                        </span>
                                    {% endif %}
                                </h4>
                                
                                <div class="activity-location">
                                    <i class="fas fa-map-marker-alt"></i>
                                    <span class="editable-text" data-field="location" data-placeholder="Add location">{{ activity.location or 'Location' }}</span>
                                </div>
                            </div>
                            
                            {% if activity.notes %}
                            <div class="activity-notes">
                                <div class="notes-content">
                                    <div class="editable-textarea" data-field="notes" data-placeholder="Add notes about this activity...">{{ activity.notes }}</div>
                                </div>
                            </div>
                            {% endif %}
                            
                            {% if activity.special and day_num == 3 %}
                            <div class="proposal-highlight-box">
                                <div class="highlight-icon">
                                    <i class="fas fa-heart"></i>
                                </div>
                                <div class="highlight-text">
                                    <strong>This is it!</strong> The moment you've been planning for.
                                </div>
                                <div class="highlight-sparkles">‚ú®üíç‚ú®</div>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                    
                    {% if not activities %}
                    <div class="empty-day">
                        <div class="empty-icon">
                            <i class="fas fa-calendar-plus"></i>
                        </div>
                        <p>No activities planned for this day yet</p>
                        <button class="btn btn-primary add-day-activity" data-day="{{ day_num }}">
                            <i class="fas fa-plus"></i>
                            Add First Activity
                        </button>
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Itinerary Insights -->
    <div class="itinerary-insights">
        <h2 class="insights-title">
            <i class="fas fa-analytics"></i>
            Trip Overview
        </h2>
        
        <div class="insights-grid">
            <div class="insight-item">
                <div class="insight-icon activities">
                    <i class="fas fa-list-check"></i>
                </div>
                <div class="insight-content">
                    <div class="insight-number">{{ itinerary_items|length }}</div>
                    <div class="insight-label">Total Activities</div>
                </div>
            </div>
            
            <div class="insight-item">
                <div class="insight-icon special">
                    <i class="fas fa-star"></i>
                </div>
                <div class="insight-content">
                    <div class="insight-number">{{ itinerary_items|selectattr('special')|list|length }}</div>
                    <div class="insight-label">Special Moments</div>
                </div>
            </div>
            
            <div class="insight-item">
                <div class="insight-icon days">
                    <i class="fas fa-calendar-days"></i>
                </div>
                <div class="insight-content">
                    <div class="insight-number">3</div>
                    <div class="insight-label">Perfect Days</div>
                </div>
            </div>
            
            <div class="insight-item proposal-insight">
                <div class="insight-icon proposal">
                    <i class="fas fa-gem"></i>
                </div>
                <div class="insight-content">
                    <div class="insight-number">1</div>
                    <div class="insight-label">Life-Changing Moment</div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Add Activity Modal -->
<div class="glass-overlay" id="add-activity-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">Add New Activity</h3>
            <button class="modal-close" data-modal="add-activity-modal">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <form class="modal-form" id="add-activity-form">
            <div class="form-row">
                <div class="form-group">
                    <label for="activity-day">Day</label>
                    <select name="day" id="activity-day" required>
                        <option value="">Select day</option>
                        <option value="1">Day 1 - September 24 (Arrival)</option>
                        <option value="2">Day 2 - September 25 (Exploration)</option>
                        <option value="3">Day 3 - September 26 (Proposal Day) üíç</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>
                        <input type="checkbox" name="special" id="activity-special">
                        Mark as Special Moment
                    </label>
                </div>
            </div>
            
            <div class="form-group">
                <label for="activity-name">Activity</label>
                <input type="text" name="activity" id="activity-name" placeholder="What are you doing?" required>
            </div>
            
            <div class="form-group">
                <label for="activity-location">Location</label>
                <input type="text" name="location" id="activity-location" placeholder="Where is this happening?">
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="activity-start-time">Start Time</label>
                    <input type="time" name="start_time" id="activity-start-time">
                </div>
                
                <div class="form-group">
                    <label for="activity-end-time">End Time</label>
                    <input type="time" name="end_time" id="activity-end-time">
                </div>
            </div>
            
            <div class="form-group">
                <label for="activity-notes">Notes</label>
                <textarea name="notes" id="activity-notes" placeholder="Any special notes or details..." rows="3"></textarea>
            </div>
            
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" data-modal="add-activity-modal">Cancel</button>
                <button type="submit" class="btn btn-primary">Add Activity</button>
            </div>
        </form>
    </div>
</div>

<!-- Delete Activity Modal -->
<div class="glass-overlay" id="delete-activity-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">Delete Activity</h3>
            <button class="modal-close" data-modal="delete-activity-modal">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="modal-body">
            <p>Are you sure you want to delete this activity? This action cannot be undone.</p>
        </div>
        
        <div class="modal-actions">
            <button type="button" class="btn btn-secondary" data-modal="delete-activity-modal">Cancel</button>
            <button type="button" class="btn btn-danger" id="confirm-delete-activity">Delete Activity</button>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/itinerary.js') }}"></script>
{% endblock %}